var baseURL,defaultLng,lang,table_list,driver_list,region_list,department_list,equipment_list,fuelType_list,enginePowerType_list,jqx_theme_1,fmsClass,jqxgridClass,definesClass,opClass,datagrid,editWindowType,user_authorization,currencies,vehicle_list,dynaClass,ddown_control,ajax_options,FMSVehicleCardListActive,FMSVehicleCardInsertActive,FMSVehicleCardUpdateActive,FMSVehicleCardDeleteActive;ddown_control=0;jqx_theme_1="arctic";fmsClass=new library();jqxgridClass=new jqxgrid_library();definesClass=new defines_library();opClass=new op_library();dynaClass=new dynatree_library();lang=new Object();function initForm(){fmsClass.catch_javascript_error_log();user_authorization=fmsClass.create_user_authorization(FMSVehicleCardListActive,FMSVehicleCardInsertActive,FMSVehicleCardUpdateActive,FMSVehicleCardDeleteActive);get_JSON_List();createDataGrid();system_addEventListener()}function get_JSON_List(){table_list=fmsClass.get_request_list(option={op:"fms_vehicle_list",servlet:"/FmsVehicleServlet"});driver_list=fmsClass.get_request_list(option={op:"fms_driver_list",servlet:"/FmsDriverServlet"});region_list=fmsClass.get_request_list(option={op:"fms_region_list",servlet:"/FmsRegionServlet"});department_list=fmsClass.get_request_list(option={op:"fms_department_list",servlet:"/FmsDepartmentServlet"});equipment_list=fmsClass.get_request_list(option={op:"fms_equipment_list",servlet:"/FmsEquipmentServlet"});var a=fmsClass.clone_parent_vehicles();vehicle_list=[];vehicle_list.push(a[1]);vehicle_list.push(a[0]);fuelType_list=definesClass.get_fuelType_json();enginePowerType_list=definesClass.get_enginePowerType_json();currencies=definesClass.get_currencies_json()}function system_addEventListener(){fmsClass.disabled_default_contextMenu();fmsClass.toggle_backspace_event();fmsClass.search_casesens();fmsClass.addEvent_window_resize(jqxgridClass.resize_jqxgrid_auto);opClass.create_fms_mail_info_icon("vehicles");fmsClass.merge_object_field(driver_list,"dName","dSurname","customDriverName");var c=fmsClass.set_jqx_combobox_renderJson(driver_list,"customDriverName","value","dId");var g=fmsClass.set_jqx_combobox_renderJson(region_list,"frName","value","id");var e=fmsClass.set_jqx_combobox_renderJson(department_list,"fdName","value","fdId");var f=fmsClass.set_jqx_combobox_renderJson(equipment_list,"feName","value","feId");var d=fmsClass.set_jqx_combobox_renderJson(fuelType_list,"name","value","value");var b=fmsClass.set_jqx_combobox_renderJson(enginePowerType_list,"name","value","value");var a={width:140,theme:jqx_theme_1,datetime:true,datetime_allow_null:true,combobox:true,switchbutton:false,checkbox:true,number:false,maskNumber:true,price:true,div:"#opWindow",gridContextMenu:"#datagrid_contextMenu"};opClass.create_jqxHtmlElement(a);opClass.mask_jqx_phone();opClass.create_jqx_insertEditWindow("#opWindow",true,940,500,jqx_theme_1);fmsClass.create_jqx_alertWindow("#alert-dialog",null,null,jqx_theme_1,jqx_theme_1);fmsClass.create_jqx_panel("#fvVehicleId_panel",300,250,jqx_theme_1);fmsClass.create_jqx_dropdown(".dropdown",156,19,250,jqx_theme_1);$("#fvVehicleId_dropdown").jqxDropDownButton({dropDownWidth:300});$(".datetime").jqxDateTimeInput({width:162});$(".price").jqxNumberInput({symbol:" "+currencies[0].icon,symbolPosition:"right"});$("#opWindow table #fvDriver").jqxComboBox({source:c,displayMember:"customDriverName",valueMember:"dId"});$("#opWindow table #fvRegion").jqxComboBox({source:g,displayMember:"frName",valueMember:"id"});$("#opWindow table #fvFuelType").jqxComboBox({source:d,displayMember:"name",valueMember:"value"});$("#opWindow table #fvEnginePowerType").jqxComboBox({width:82,source:b,displayMember:"name",valueMember:"value"});$("#opWindow table #fvDepartment").jqxComboBox({source:e,displayMember:"fdName",valueMember:"fdId"});$("#opWindow table #fvEquipment").jqxComboBox({source:f,displayMember:"feName",valueMember:"feId"});$(".add_op").click(function(){editWindowType="insert";opClass.addRow_jqxgrid_confirm("/FmsVehicleServlet","fms_vehicle_insert",table_list,"#opWindow",render_vehicleList,form_validation)});$(".edit_op").click(function(){editWindowType="edit";opClass.updateRow_jqxgrid_confirm("/FmsVehicleServlet","fms_vehicle_update","fvVehicleId",table_list,"fms_vehicle_info","#opWindow",customServerObjectRenderer,null,null,render_vehicleList,null,form_validation)});$(".delete_op").click(function(){editWindowType="delete";opClass.deleteRow_jqxgrid_confirm("/FmsVehicleServlet","fms_vehicle_delete","fvVehicleId",table_list,"#opWindow")});$("#datagrid_fms_def_vehicles").on("rowdoubleclick",function(){editWindowType="edit";opClass.updateRow_jqxgrid_confirm("/FmsVehicleServlet","fms_vehicle_update","fvVehicleId",table_list,"fms_vehicle_info","#opWindow",customServerObjectRenderer,null,null,render_vehicleList,null,form_validation)});jqxgridClass.add_jqxgrid_rowclick_event("#datagrid_fms_def_vehicles","#datagrid_contextMenu");$("#datagrid_contextMenu").on("itemclick",function(i){var h=i.args;var j=$(h).attr("id");if(j=="dgrid_context_edit"){editWindowType="edit";opClass.updateRow_jqxgrid_confirm("/FmsVehicleServlet","fms_vehicle_update","fvVehicleId",table_list,"fms_vehicle_info","#opWindow",customServerObjectRenderer,null,null,render_vehicleList,null,form_validation)}else{if(j=="dgrid_context_delete"){editWindowType="delete";opClass.deleteRow_jqxgrid_confirm("/FmsVehicleServlet","fms_vehicle_delete","fvVehicleId",table_list,"#opWindow")}}});$("#fvVehicleIdTreeSearch").bind("focus click",function(h){if(ddown_control==0){var i=$("#fvVehicleId_dropdown").jqxDropDownButton("isOpened");if(!i){$("#fvVehicleId_dropdown").jqxDropDownButton("open")}}});$("#fvVehicleId_dropdown").on("open",function(h){ddown_control=1;dynaClass.size_group($("#fvVehicleId"));setTimeout(function(){$("#fvVehicleIdTreeSearch").focus()},100)});$("#fvVehicleId_dropdown").on("close",function(h){ddown_control=0});$("#fvVehicleIdTreeSearch").bind("keyup",function(h){dynaClass.search_dynatree_element("#fvVehicleId",this);if(h.which==13){dynaClass.select_dynatree_result(this,"#fvVehicleId",null,h,"single")}});$("#opWindow").on("open",function(){if(editWindowType=="insert"){$(".dropdown").jqxDropDownButton("setContent","");$("#fvVehicleIdTreeSearch").jqxInput({disabled:false});$("#fvVehicleId_dropdown").jqxButton({disabled:false});$("#fvVehicleId_panel").jqxPanel({disabled:false})}else{$("#fvVehicleIdTreeSearch").jqxInput({disabled:true});$("#fvVehicleId_dropdown").jqxButton({disabled:true});$("#fvVehicleId_panel").jqxPanel({disabled:true})}create_vehicles_tree()});jqxgridClass.resize_jqxgrid_auto()}function createDataGrid(){render_vehicleList();fmsClass.add_list_idNumber(table_list);var c={localdata:table_list,datafields:[{name:"fvVehicleId",type:"int"},{name:"index",type:"int"},{name:"fvPlate",type:"string"},{name:"fvBrand",type:"string"},{name:"fvModel",type:"string"},{name:"fvModelYear",type:"int"},{name:"fvColor",type:"string"},{name:"fvInspectionDate",type:"date"}],datatype:"array",id:"fvVehicleId"};var b=[{text:lang.idNo,datafield:"index",width:60},{text:lang.plate,datafield:"fvPlate",width:150,cellsrenderer:set_null_controller},{text:lang.brand,datafield:"fvBrand",width:150,cellsrenderer:set_null_controller},{text:lang.model,datafield:"fvModel",width:150,cellsrenderer:set_null_controller},{text:lang.modelYear,datafield:"fvModelYear",width:100,cellsrenderer:set_null_controller},{text:lang.color,datafield:"fvColor",width:100,cellsrenderer:set_null_controller},{text:lang.inspectionDate,datafield:"fvInspectionDate",width:135,filtertype:"date",cellsformat:jqxgridClass.get_date_format(),cellsrenderer:set_null_controller}];var a={theme:jqx_theme_1,isSorter:true,isFilterArrow:true,isFilter:true,isGroupable:true,isColMenu:true,isColumnResize:true,isShowToolbar:true,toolbarOptions:{insertActive:FMSVehicleCardInsertActive,updateActive:FMSVehicleCardUpdateActive,deleteActive:FMSVehicleCardDeleteActive}};datagrid=jqxgridClass.create_jqxgrid(c,b,"#datagrid_fms_def_vehicles",a)}function render_vehicleList(c){var a=[];if(c!=null){a.push(c)}else{a=table_list}if(a==null||a.length==0){return}for(var b=0;b<a.length;b++){var e=a[b];var d=fmsClass.get_listById_equal(vehicle_list[1],e.fvVehicleId,"vehicleId");if(e.fvInspectionTime!=null){fmsClass.set_object_timeConvertDate(e)}if(d!=null){e.fvPlate=d.plate}}}function create_vehicles_tree(){var g=[];var l=datagrid.jqxGrid("getrows");if(vehicle_list[1]!=null){for(var e=0;e<vehicle_list[1].length;e++){var b=vehicle_list[1][e];var c=fmsClass.get_listById_equal(l,b.vehicleId,"fvVehicleId");if(c==null){g.push(b)}}}if(editWindowType=="edit"){var j=datagrid.jqxGrid("getselectedrowindex");var d=datagrid.jqxGrid("getrowdata",j);var a=fmsClass.get_listById_equal(vehicle_list[1],d.fvVehicleId,"vehicleId");g.push(a)}dynaClass.destroy_dynatree("#fvVehicleId");var k=dynaClass.create_dynatree("#fvVehicleId",false,null,null,fms_dynaSingleSelect);var h=[];var f=new Object();f.vehicleNameMerge="";dynaClass.add_dynatree_list(h,vehicle_list[0],g,lang.allVehicles,lang.noneGroup,k,"groupId",f);dynaClass.toggle_dynatree_allItems($("#fvVehicleId"),true);if(editWindowType=="edit"){$("#fvVehicleId").dynatree("disable")}else{$("#fvVehicleId").dynatree("enable")}}var fms_dynaSingleSelect=function(c){var b,d;if(c.obj!=null){b=c.obj;d=b.plate+" / "+b.displayName}else{d=""}var a='<div title="'+d+'" style="position: relative; margin-left: 3px; margin-top: 5px;">'+d+"</div>";$("#fvVehicleId_dropdown").jqxDropDownButton("setContent",a);opClass.set_header_insertEditWindow(d);$("#fvVehicleId_dropdown").jqxDropDownButton("close")};function customServerObjectRenderer(a,b){if(b=="single"){render_vehicleList(a);return a}else{render_vehicleList(a[0]);return a[0]}}function form_validation(){var a=[{label:"fvVehicleId",type:"tree",emptyMsg:lang.pleaseSelectYourVehicle}];return fmsClass.control_form_fields(a)};